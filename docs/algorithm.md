---
comments: true
title: "Алгоритм подсчета долгов"
---

# Алгоритм подсчета долгов

Для подсчета долгов пользователей предлагается использовать матричную структуру, размерности $N \times N$, где $N$ - количество пользователей в сессии.

## Инициализация матрицы долгов

На первом этапе матрица заполняется нулевыми значениями. 

Рассмотрим матрицу для 4 пользователей.

$$
\text{DebtMtr} =
\begin{bmatrix}
0 & 0 & 0 & 0 \\
0 & 0 & 0 & 0 \\
0 & 0 & 0 & 0 \\
0 & 0 & 0 & 0
\end{bmatrix}
$$

Свойства матрицы:  

- $i$-ая строка матрицы описывает должников $i$-го пользователя.  
- $j$-ый столбец матрицы описывает долги $j$-го пользователя.  
- Элементы главной диагонали принимают только нулевые значения (это обусловлено смыслом задачи - пользователь не может быть должен/должником самому себе).

$$\text{DebtMtr}_{ii} = 0, i = \overline{1..N}$$

## Обработка конкретной затраты

Пусть для сессии из 4 пользователей произошли следующие затраты:  

- Пользователь 1:  
    1. Товар 1_1 - 1000 руб.  
    2. Товар 1_2 - 2000 руб.  
- Пользователь 2:  
    1. Товар 2_1 - 300 руб.  
- Пользователь 3:  
    1. Товар 3_1 - 500 руб.  
    2. Товар 3_2 - 100 руб.  
    3. Товар 3_3 - 1500 руб.  
- Пользователь 4 без трат.  

Товар 1_1 будет разделен между всеми участниками.

$$1000 / 4 = 250$$

Тогда матрица долгов будет иметь следующий вид: 

$$
\text{DebtMtr} =
\begin{bmatrix}
0 & 0 & 0 & 0 \\
0 & 0 & 0 & 0 \\
0 & 0 & 0 & 0 \\
0 & 0 & 0 & 0
\end{bmatrix}
\rightarrow
\text{DebtMtr} =
\begin{bmatrix}
0 & 250 & 250 & 250 \\
0 & 0 & 0 & 0 \\
0 & 0 & 0 & 0 \\
0 & 0 & 0 & 0
\end{bmatrix}
$$

Т.е. первому пользователю, пользователь 2, 3, 4 должны по 250 руб. Остальные затраты будут обработаны аналогичным образом. Итоговая матрица затрат:

$$
\text{DebtMtr} =
\begin{bmatrix}
0 & 750 & 750 & 750 \\
75 & 0 & 75 & 75 \\
525 & 525 & 0 & 525 \\
0 & 0 & 0 & 0
\end{bmatrix}
$$

## Минимизация количества переводов 

В рамках рассматриваемого примера возникла сдедующая ситуация:

- пользователь 2 должен пользователю 1 250 руб;
- пользователь 1 должен пользователю 2 75 руб.

Таким образом для ненулевых элементов матрицы, симметричных относительно главной диагонали, необходимо выполнить следующую операцию: 

```
if DebtMtr[i][j] > DebtMtr[j][i]:
    DebtMtr[i][j] = DebtMtr[i][j] - DebtMtr[j][i]
    DebtMtr[j][i] = 0 
else:
    DebtMtr[j][i] = DebtMtr[j][i] - DebtMtr[i][j] 
    DebtMtr[i][j]  = 0 
```

Итого получаем:

$$
\text{DebtMtr} =
\begin{bmatrix}
0 & 675 & 225 & 750 \\
0 & 0 & 0 & 75 \\
0 & 450 & 0 & 525 \\
0 & 0 & 0 & 0
\end{bmatrix}
$$
